<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - SUST Digital Attendance</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">ðŸŽ“ SUST Digital Attendance</div>
            <div class="flex gap-md">
                <span id="teacher-name" class="text-secondary"></span>
                <button onclick="logout()" class="btn btn-outline">Logout</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Welcome Section -->
        <div class="mb-lg fade-in">
            <h1>Teacher Dashboard</h1>
            <p id="teacher-info"></p>
        </div>

        <!-- Alert Container -->
        <div id="alert-container"></div>

        <!-- Create Class Section -->
        <div class="card mb-lg fade-in">
            <div class="card-header">
                <h2>Create New Class</h2>
            </div>
            <div class="card-body">
                <form id="create-class-form">
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Class Details</label>
                            <input type="text" id="class-name" class="form-input"
                                placeholder="Class Course code - Section - Class Number" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Class Type</label>
                            <select id="class-type" class="form-select" required>
                                <option value="">Select type</option>
                                <option value="online">Online</option>
                                <option value="offline">Offline</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Linked Course (Optional)</label>
                        <select id="class-course" class="form-select">
                            <option value="">Individual Class (No Course)</option>
                            <!-- Course options will be populated dynamically -->
                        </select>
                        <small style="color: var(--text-secondary); font-size: 0.85rem;">
                            Select a course to track cumulative attendance, or leave as "Individual Class"
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Validation Code</label>
                        <div class="flex gap-sm">
                            <input type="text" id="validation-code" class="form-input" placeholder="e.g., ABC123"
                                required>
                            <button type="button" onclick="generateRandomCode()" class="btn btn-secondary">
                                Generate
                            </button>
                        </div>
                    </div>

                    <div id="location-section" class="hidden">
                        <div class="form-group">
                            <div id="location-display"></div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-success" style="width: 100%;">
                        <span id="create-btn-text">Create Class</span>
                        <div id="create-spinner" class="spinner spinner-small hidden"></div>
                    </button>
                </form>
            </div>
        </div>

        <!-- My Courses Section -->
        <div class="card mb-lg fade-in">
            <div class="card-header flex-between">
                <div>
                    <h2>My Courses</h2>
                </div>
                <div class="flex gap-sm">
                    <button onclick="openCourseManagementModal()" class="btn btn-primary">
                        Create New Course
                    </button>
                    <button onclick="loadTeacherCourses()" class="btn btn-secondary">
                        Refresh
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="courses-loading" class="flex-center" style="padding: 2rem;">
                    <div class="spinner"></div>
                </div>
                <div id="courses-container" class="hidden"></div>
            </div>
        </div>

        <!-- My Classes Section -->
        <div class="card fade-in">
            <div class="card-header flex-between">
                <div>
                    <h2>My Classes</h2>
                </div>
                <button onclick="loadMyClasses()" class="btn btn-secondary">
                    Refresh
                </button>
            </div>
            <div class="card-body">
                <div id="classes-loading" class="flex-center" style="padding: 2rem;">
                    <div class="spinner"></div>
                </div>
                <div id="classes-container" class="hidden"></div>
            </div>
        </div>
    </div>

    <!-- View Attendance Modal -->
    <div id="attendance-modal" class="modal hidden">
        <div class="modal-overlay" onclick="closeAttendanceModal()"></div>
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 id="modal-class-name"></h2>
                <button onclick="closeAttendanceModal()" class="btn-close">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="modal-alert"></div>

                <div class="flex-between mb-md">
                    <div>
                        <p class="text-secondary" style="margin: 0;">Total Students: <strong
                                id="total-students">0</strong></p>
                    </div>
                    <button id="export-btn" class="btn btn-primary">
                        Export to Excel
                    </button>
                </div>

                <!-- Compact Header -->
                <div class="compact-row"
                    style="background: var(--bg-tertiary); font-weight: 600; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.03em; color: var(--text-secondary);">
                    <div class="row-main">
                        <span class="row-sl">SL</span>
                        <span class="row-reg">Reg. Number</span>
                        <span class="row-name">Name</span>
                    </div>
                    <span class="row-time">Time</span>
                </div>

                <div id="attendance-list"></div>
            </div>
        </div>
    </div>

    <!-- Update Code Modal -->
    <div id="code-modal" class="modal hidden">
        <div class="modal-overlay" onclick="closeCodeModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Update Validation Code</h2>
                <button onclick="closeCodeModal()" class="btn-close">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="code-modal-alert"></div>
                <div class="form-group">
                    <label class="form-label">New Validation Code</label>
                    <div class="flex gap-sm">
                        <input type="text" id="new-validation-code" class="form-input" required>
                        <button type="button" onclick="generateRandomCodeForUpdate()" class="btn btn-secondary">
                            Generate
                        </button>
                    </div>
                </div>
                <button id="update-code-btn" class="btn btn-success" style="width: 100%;">
                    Update Code
                </button>
            </div>
        </div>
    </div>

    <!-- Cumulative Attendance Modal -->
    <div id="cumulative-modal" class="modal hidden">
        <div class="modal-overlay" onclick="closeCumulativeModal()"></div>
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="cumulative-course-name"></h2>
                <button onclick="closeCumulativeModal()" class="btn-close">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="cumulative-modal-alert"></div>

                <div class="flex-between mb-md">
                    <div>
                        <p class="text-secondary" style="margin: 0;">Total Students: <strong
                                id="cumulative-total-students">0</strong></p>
                    </div>
                    <button id="export-cumulative-btn" class="btn btn-primary">
                        Export to Excel
                    </button>
                </div>

                <!-- Compact Header -->
                <div class="compact-row"
                    style="background: var(--bg-tertiary); font-weight: 600; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.03em; color: var(--text-secondary);">
                    <div class="row-main">
                        <span class="row-sl">SL</span>
                        <span class="row-reg">Reg. Number</span>
                        <span class="row-name">Name</span>
                    </div>
                    <span class="row-time">Classes Attended</span>
                </div>

                <div id="cumulative-attendance-list"></div>
            </div>
        </div>
    </div>

    <!-- Course Creation Modal -->
    <div id="course-management-modal" class="modal hidden">
        <div class="modal-overlay" onclick="closeCourseManagementModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Course</h2>
                <button onclick="closeCourseManagementModal()" class="btn-close">Ã—</button>
            </div>
            <div class="modal-body">
                <!-- Create Course Form inside Modal -->
                <form id="create-course-form">
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Course Code</label>
                            <input type="text" id="course-code" class="form-input" placeholder="e.g., CSE101" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Session</label>
                            <input type="text" id="course-session" class="form-input" placeholder="e.g., 2024-2025"
                                required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Course Name</label>
                        <input type="text" id="course-name" class="form-input"
                            placeholder="e.g., Programming Fundamentals" required>
                    </div>

                    <button type="submit" class="btn btn-success" style="width: 100%;">
                        <span id="create-course-btn-text">Create Course</span>
                        <div id="create-course-spinner" class="spinner spinner-small hidden"></div>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Update Location Modal -->
    <div id="location-modal" class="modal hidden">
        <div class="modal-overlay" onclick="closeLocationModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Update Class Location</h2>
                <button onclick="closeLocationModal()" class="btn-close">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="location-modal-alert"></div>

                <div class="text-center mb-md">
                    <p class="text-secondary">Click the button below to get your current location.</p>
                </div>

                <div id="update-location-display" class="mb-md"></div>

                <div class="flex gap-md">
                    <button type="button" onclick="getUpdateLocation()" class="btn btn-secondary" style="flex: 1;">
                        Get Location
                    </button>
                    <button id="update-location-btn" class="btn btn-success" style="flex: 1;" disabled>
                        Update
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>Â© 2024 All rights reserved.</p>
    </footer>

    <script src="/js/auth.js"></script>
    <script src="/js/teacher.js"></script>
</body>

</html>